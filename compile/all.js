function getKeyFrames(){var t=GsifReader.document.children[1].keyframes;console.log(t);var e=document.getElementById("keyframeDefault"),i=document.getElementById("excessKeys");i.innerHTML="";for(var r=0;r<t.length;r++){var n=jL.div("keyframe",void 0,e.innerHTML);i.appendChild(n);var s=n.getElementsByClassName("playback")[0];s.i=r,s.addEventListener("click",function(){playKeyframe(this.i),this.checked=!1}),n.getElementsByClassName("frame")[0].value=t[r].time.frames,n.getElementsByClassName("second")[0].value=t[r].time.seconds,n.getElementsByClassName("name")[0].innerHTML="Keyframe "+r+":",t[r].desc&&(n.getElementsByClassName("desc")[0].value=t[r].desc.text),n.getElementsByClassName("active")[0].checked=t[r].active}}function playKeyframe(t){function e(){SIFRenderer.renderer.time.add(new Time(1/Time.fps,0)),drawRenderer()}var i=GsifReader.document.children[1].keyframes;document.getElementById("keyframe-details").removeAttribute("open"),null!==playBack&&(clearInterval(playBack),playBack=null),drawRenderer(),SIFRenderer.renderer.time=Time.parse(i[t].time+""),drawRenderer(),document.getElementById("animate").checked&&(playBack=setInterval(e,1e3/Time.fps))}function TagBuilder(t,e,i,r){this.attrs=i||[],this.selfClosing=r,this.tag=e,this.closeTag=r?null:"</"+e+">",this.parent=t,this.children=[],this.build(),this.isComposite=e.indexOf&&-1!=e.indexOf("composite")}function SIFReader(){this.document=new TagBuilder(null,TagBuilder.documentType),this.document.parent=this,this.context=this.document,this.resetLine(),this.VERBOSE=!0}function SIFRenderer(t){this.document=t,this.shouldDrawOr=!1,this.dCanvas=document.createElement("CANVAS"),this.sifCanvas=this.document.children[1];var e=1;ISHIGHDEF&&(e=2),this.dCanvas.width=this.sifCanvas.origin.x*this.sifCanvas.scale.x*2*e*gsSCALE,this.dCanvas.height=this.sifCanvas.origin.y*this.sifCanvas.scale.y*2*e*gsSCALE;var i=this.sifCanvas.origin.x*this.sifCanvas.scale.x*2*gsSCALE,r=this.sifCanvas.origin.y*this.sifCanvas.scale.y*2*gsSCALE;this.dCanvas.style.marginLeft=-i/2+"px",this.dCanvas.style.marginTop=-r/2+"px",this.dCanvas.style.width=i,this.dCanvas.style.height=r,this.dCanvas.className="centerme",document.body.appendChild(this.dCanvas),this.ctx=this.dCanvas.getContext("2d"),ISHIGHDEF&&this.ctx.scale(2*gsSCALE,2*gsSCALE),this.time=new Time,this.ctx.lineWidth=1,this.currentTransform=new transformVal({x:0,y:0},{x:0,y:0},{x:1,y:1},0,{x:1,y:1},1),this.currentTransform.transformOScale(this.sifCanvas.scale),this.currentTransform.transformOOrigin(this.sifCanvas.origin),this.transformStack=[this.currentTransform.copy()],SIFRenderer.renderer=this,this.lexicon={}}function FontData(t,e){t.font="30px fontname",this.unitheight=t.measureText("M").width/30}function transformVal(t,e,i,r,n,s){this.origin={x:t.x,y:t.y},this.oOrigin={x:e.x,y:e.y},this.angle=r,this.theta=r*Math.PI/180,this.scale={x:n.x,y:n.y},this.oScale={x:i.x,y:i.y},this.scaleR={x:i.x*n.x,y:i.y*n.y},this.a=s}function drawRenderer(){if(!SIFRenderer.renderer){new SIFRenderer(GsifReader.document)}var t,e=Date.now();t=last?new Time((e-last)/1e3,0):new Time(1/Time.fps,0),last=e,SIFRenderer.renderer.draw();for(var i=SIFRenderer.renderer.time,r=0;r<drawables.length;r++)if(drawables[r].addTime(t))SIFRenderer.renderer.time=drawables[r].currenttime,SIFRenderer.renderer.drawSomething(drawables[r]);else{if(hideeverything)break;r--}SIFRenderer.renderer.time=i,hideeverything&&(hideeverything=!1,drawRenderer())}function listLayers(){var t=GsifReader.document.getAllTypeWithAttrEq("layer","type","group"),e=document.getElementById("layer-list");e.innerHTML="";for(var i=0;i<t.length;i++){var r=document.createElement("BUTTON");r.innerHTML=t[i].attr("desc"),r.addEventListener("click",function(){pEditor.editing=this,pEditor.origin=this.getAllTypeWithAttrEq("param","name","origin",1)[0].origin,pEditor.transf=this.getAllTypeWithAttrEq("param","name","transformation",1)[0],pEditor.offset=pEditor.transf.offset,setFormProps(),dL(this)}.bind(t[i])),e.appendChild(r)}}function dL(t){SIFRenderer.renderer.save(),SIFRenderer.renderer.currentTransform.clr={r:0,g:255,b:0,a:1},SIFRenderer.drawingOrigins=!1,SIFRenderer.drawTag.layer(t,SIFRenderer.renderer.ctx,!0),SIFRenderer.drawingOrigins=!0,SIFRenderer.drawTag.layer(t,SIFRenderer.renderer.ctx,!0),SIFRenderer.renderer.restore()}function saveFormProps(){var t=pEditor.form.getElementsByClassName("desc")[0],e=pEditor.form.getElementsByClassName("x")[0],i=pEditor.form.getElementsByClassName("y")[0],r=pEditor.form.getElementsByClassName("ox")[0],n=pEditor.form.getElementsByClassName("oy")[0];pEditor.editing.attr("desc",t.value),pEditor.origin.x=parseFloat(e.value),pEditor.origin.y=parseFloat(i.value),pEditor.offset.x=parseFloat(r.value),pEditor.offset.y=parseFloat(n.value),SIFRenderer.drawTag.setLiteralNums(pEditor.editing.getAllTypeWithAttrEq("param","name","origin",1)[0],!0,pEditor.origin);var s=pEditor.editing.getAllTypeWithAttrEq("param","name","transformation",1)[0],a=s.getAllTypeWithAttrEq("offset")[0];SIFRenderer.drawTag.setLiteralNums(a,!0,pEditor.offset)}function setFormProps(){var t=pEditor.form.getElementsByClassName("desc")[0],e=pEditor.form.getElementsByClassName("x")[0],i=pEditor.form.getElementsByClassName("y")[0],r=pEditor.form.getElementsByClassName("ox")[0],n=pEditor.form.getElementsByClassName("oy")[0];t.value=pEditor.editing.attr("desc"),e.value=pEditor.origin.x+"",i.value=pEditor.origin.y+"",r.value=pEditor.offset.x+"",n.value=pEditor.offset.y+""}function PartEditor(){this.editing=null,this.shouldMove=!1,this.shouldRotate=!1,this.offset={x:0,y:0},this.origin={x:0,y:0},this.speed=1,this.form=document.getElementById("props"),window.addEventListener("keydown",this.keydown.bind(this))}function testSIFReader(){var t='<canvas name="asdf asdf" parts="asf=">',e=new SIFReader;e.readLine("<meta/>"),e.readLine(t)}function RenderLoop(){drawRenderer(),requestAnimationFrame(RenderLoop)}function Time(t,e){var i=t||0,r=e||0;this.fps=Time.fps,Object.defineProperties(this,{frames:{get:function(){return r},set:function(t){r=t,(r>this.fps||0>r)&&(h=Math.floor(r/this.fps),i+=h,r-=h*this.fps)}},seconds:{get:function(){return i},set:function(t){i=t}}}),this.frames=r}function SIFElement(t){this.attrs=t||{},this.children=[],this.parent=this}function TextElement(t){this.text=t}function GeneralElement(t){SIFElement.call(this,t),this.selfClosing=!1,this.keyAttrs=[]}function Canvas(t,e,i){GeneralElement.call(this,i),this.origin=t,this.scale=e,this.layers=[],this.metas=[],this.keyframes=[]}function DocumentElement(t){SIFElement.call(this,t)}function VectorSuper(t){SIFElement.call(this,t)}function Vector(t,e,i){VectorSuper.call(this,i),this.x=t,this.y=e,this.keys=["x","y"],this.tag="vector"}function Color(t,e,i,r,n){VectorSuper.call(this,n),this.r=Math.pow(t,1/2.2),this.g=Math.pow(e,1/2.2),this.b=Math.pow(i,1/2.2),this.a=Math.pow(r,1/2.2),this.keys=["r","g","b","a"],this.tag="color"}function Keyframe(t,e,i,r){SIFElement.call(this,r),this.time=t,this.active=e,this.desc=i,this.tag="keyframe"}function Name(t,e){SIFElement.call(this,e),this.content=t,this.tag="name"}function Layer(t,e,i,r,n,s){SIFElement.call(this,s),this.type=t,this.active=e,this.excludeFromRendering=i,this.version=r,this.keyAttrs=["type","active","excludeFromRendering","version"],n&&(this.desc=n,this.keyAttrs.push("desc")),this.paramKeys=[],this.tag="layer"}function Meta(t,e,i){SIFElement.call(this,i),this.name=t,this.content=e,this.tag="meta"}function Real(t,e){SIFElement.call(this,e),this.value=t,this.tag="real"}function SIFString(t,e){SIFElement.call(this,e),this.value=t,this.tag="string"}function Bool(t,e){Real.call(this,t,e),this.tag="bool"}function Integer(t,e){Real.call(this,t,e),this.tag="integer"}function Angle(t,e){Real.call(this,t,e),this.tag="angle"}function TagHolder(t,e){SIFElement.call(this,e),this.held=t}function Waypoint(t,e,i,r,n){SIFElement.call(this,n),this.time=e,this.before="in"+i,this.after="out"+r,this.held=t,this.tag="waypoint"}function Animated(t,e){SIFElement.call(this,e),this.type=t,this.tag="animated",this.waypoints=[],this.times=[]}function binaryIndexOf(t,e){for(var i,r=0,n=t.length-1,s=(r+n)/2|0;n>=r;)if(s=(r+n)/2|0,i=t[s],e>i)r=s+1;else{if(!(i>e))return s;n=s-1}return s}function Bline(t,e,i){SIFElement.call(this,i),this.type=t,this.loop=e,this.tag="bline",this.entries=[]}function Composite(t,e){this.type=t,"bline_point"==this.type?(SIFElement.call(this,10==arguments.length?arguments[9]:void 0),this.point=arguments[1],this.width=arguments[2],this.origin=arguments[3],this.split=arguments[4],this.t1=arguments[5],this.t2=arguments[6],this.splitRadius=arguments[7],this.splitAngle=arguments[8],this.keypairs=[["point","point"],["width","width"],["origin","origin"],["split","split"],["t1","t1"],["t2","t2"],["splitRadius","split_radius"],["splitAngle","split_angle"]]):"transformation"==this.type?(SIFElement.call(this,6==arguments.length?arguments[5]:void 0),this.offset=arguments[1],this.angle=arguments[2],this.skewAngle=arguments[3],this.scale=arguments[4],this.keypairs=[["offset","offset"],["angle","angle"],["skewAngle","skew_angle"],["scale","scale"]]):(SIFElement.call(this,e),this.keypairs=[]),this.tag="composite"}function RadialComposite(t,e,i,r){Composite.call(this,null,r),this.type=t,this.tag="radial_composite",this.radius=e,this.theta=i,this.keypairs=[["radius","radius"],["theta","theta"]]}function testAllSif(){var t=new Vector(2,3,{test:"222"});console.log(t.toXML("    ","  "));var e=new Color(.5,.7,.8,1,{test:"222"});console.log(e+""),console.log(e.toXML("    ","  "));var i=new Bool(!0,{test:"222"});console.log(i.toXML("    ","  "));var r=new Real(.5,{test:"222"});console.log(r.toXML("    ","  "));var n=new Waypoint(t,.733324422,"clamped","clamped",{test:"222"});console.log(n.toXML("    ","  "));var s=new Animated("vector",{test:"222"});s.addWaypoint(n),s.addWaypoint(n),s.addWaypoint(n),console.log(s.toXML("    ","  "));var a=new RadialComposite("vector",new Real(0),new Angle(-45)),o=new Waypoint(new Real(0,{guid:"98B2B48E313025BF7EA6E1D594BEF41C"}),0,"clamped","clamped"),h=new Waypoint(new Real(0,{guid:"9C4023CFE8029896805ABAC23FF015F4"}),.70833331,"clamped","clamped"),l=new Animated("real");l.addWaypoint(o),l.addWaypoint(h);var c=new Waypoint(new Real(0,{guid:"67F1B8C372CF3A7EDB20922B2ACB6BE5"}),0,"clamped","clamped"),u=new Waypoint(new Angle(-45,{guid:"737BCAE73EA11364CC87F88EA748E052"}),.70833331,"clamped","clamped"),d=new Animated("angle");d.addWaypoint(c),d.addWaypoint(u);var p=new RadialComposite("vector",l,d),f=new Composite("bline_point",new Vector(5,5),new Real(4),new Real(1),new Bool(!0),p,a,new Bool(!0),new Bool(!0)),m=f,g=new Bline("bline_point",!0);g.addEntry(m),g.addEntry(m),g.addEntry(m),g.addEntry(m),console.log(g.toXML("    ","  "));var y=new Meta("background_first_color","0.880000 0.880000 0.880000");console.log(y.toXML("    ","  "));var v=new Keyframe(10,!0);console.log(v.toXML("    ","  "));var x=new Name("SYNFIG ANIMATION 8");console.log(x.toXML("    ","  "))}function SIFObject(t,e,i,r){var n=t.document.children[1].keyframes;this.document=t.document,-1==e?this.starttime=t.starttime:this.starttime=n[e].time,-1==i?this.endtime=t.endtime:this.endtime=n[i].time,this.currenttime=Time.parse(this.starttime+""),this.loops=t.loops,this.call=r}function loadSif(t){SIFRenderer.renderer&&(playBack&&(clearInterval(playBack),playBack=null),document.body.removeChild(SIFRenderer.renderer.dCanvas),document.body.removeChild(document.body.children[document.body.children.length-1])),SIFRenderer.renderer=null;var e=new SIFReader;GsifReader=e;for(var i=mySifs[t].data.split("\n"),r=!0,n=0;n<i.length;n++){var s=i[n];if(i[n]=null,r){var a=s.indexOf("<string>");if(-1!=a){var o=s.substring(0,a).trim();s=s.substring(a),o.length>0&&e.readLine(o),r=!1}}var a=s.indexOf("</string>");if(-1!=a){a+=9;var o=s.substring(a).trim();s=s.substring(0,a),e.readLine(s),o.length>0&&e.readLine(o),r=!0}else r&&(s=s.trim()),e.readLine(s)}e.document.finish(),mySifs[t].document=e.document,mySifs[t].starttime=Time.parse(mySifs[t].document.children[1].attrs["begin-time"]),mySifs[t].endtime=Time.parse(mySifs[t].document.children[1].attrs["end-time"])}var jL={objCons:{}.constructor,aryCons:[].constructor,strCons:"".constructor,text:function(t){return document.createTextNode(t)},div:function(t,e,i){return jL.make("div",{className:t,id:e,innerHTML:i})},bind:function(t,e,i,r){r=r||t,t.addEventListener(e,i.bind(r))},canvas:function(t,e,i,r){return jL.make("canvas",{className:t,id:e,width:i,height:r})},subClass:function(t,e){e.prototype=Object.create(t.prototype),e.prototype.constructor=e},append:function(t,e){if(e||(e=document.body),t)if(t.constructor!=jL.aryCons)t.constructor==jL.strCons&&(t=document.createTextNode(t)),e.appendChild(t);else for(var i=0;i<t.length;i++)jL.append(e,t[i])},divAdd:function(t){for(var e=jL.div(t),i=1;i<arguments.length;i++)jL.append(arguments[i],e);return e},make:function(t,e){if(!t)return void console.error("Util.make failed with tag: "+t);var i=document.createElement(t);for(var r in e)e[r]&&(i[r]=e[r]);return i}},GsifReader,playBack=null;TagBuilder.prototype.addChild=function(t){this.children.push(t)},TagBuilder.prototype.build=function(t){for(var e=0;e<this.attrs.length;e++){var i=this.attrs[e],r=i.indexOf("=");-1!=r?(this.attrs[e]=[],this.attrs[e][0]=i.substring(0,r).trim(),this.attrs[e][1]=i.substring(r+1).trim(),this.attrs[e][1]=this.attrs[e][1].substring(1,this.attrs[e][1].length-1)):this.attrs[e]=[i]}},TagBuilder.documentType="GlobalDocument",TagBuilder.prototype.finish=function(t){var e=keyUpper(this.tag);!this.parent.isComposite&&this[e]&&this[e]()},TagBuilder.prototype.attrsObj=function(){for(var t={},e=0;e<this.attrs.length;e++)this.attrs[e].length>1?t[this.attrs[e][0]]=this.attrs[e][1]:t[this.attrs[e][0]]=!0;return t},TagBuilder.prototype.vector=function(){var t=parseFloat(this.getAllTypeWithAttrEq("x",0,0,1)[0].children[0].text),e=parseFloat(this.getAllTypeWithAttrEq("y",0,0,1)[0].children[0].text),i=this.attrsObj(),r=new Vector(t,e,i),n=this.parent.children.indexOf(this);this.parent.children[n]=r},TagBuilder.prototype.string=function(){for(var t=this.attrsObj(),e=this.parent.children.indexOf(this),i="",r=0;r<this.children.length;r++)i+=this.children[r].text,r+1!=this.children.length&&(i+="\n");this.parent.children[e]=new SIFString(i,t)},TagBuilder.prototype.integer=function(){var t=parseInt(this.remAttr("value")),e=this.attrsObj(),i=new Integer(t,e),r=this.parent.children.indexOf(this);this.parent.children[r]=i},TagBuilder.prototype.real=function(){var t=parseFloat(this.remAttr("value")),e=this.attrsObj(),i=new Real(t,e),r=this.parent.children.indexOf(this);this.parent.children[r]=i},TagBuilder.prototype.bool=function(){var t=this.remAttr("value");t="false"!=t;var e=this.attrsObj(),i=new Bool(t,e),r=this.parent.children.indexOf(this);this.parent.children[r]=i},TagBuilder.prototype.angle=function(){var t=parseFloat(this.remAttr("value")),e=this.attrsObj(),i=new Angle(t,e),r=this.parent.children.indexOf(this);this.parent.children[r]=i},TagBuilder.prototype.radialComposite=function(){var t=this.remAttr("type"),e=this.attrsObj(),i=new Composite(null,e);i.tag="radial_composite",i.type=t;for(var r=0;r<this.children.length;r++){var n=this.children[r],s=keyUpper(n.tag);i[s]=n.children[0],i.keypairs.push([s,n.tag])}var a=this.parent.children.indexOf(this);this.parent.children[a]=i},TagBuilder.prototype.composite=function(){var t=this.remAttr("type"),e={},e=this.attrsObj(),i=new Composite(null,e);i.tag="composite",i.type=t;for(var r=0;r<this.children.length;r++){var n=this.children[r],s=keyUpper(n.tag);i[s]=n.children[0],i.keypairs.push([s,n.tag])}var a=this.parent.children.indexOf(this);this.parent.children[a]=i},TagBuilder.prototype.waypoint=function(){var t=Time.parse(this.remAttr("time")),e=this.remAttr("before"),i=this.remAttr("after"),r=this.attrsObj(),n=new Waypoint(this.children[0],t,e,i,r),s=this.parent.children.indexOf(this);this.parent.children[s]=n},TagBuilder.prototype.bline=function(){var t=this.remAttr("type"),e=this.remAttr("loop");e="false"!=e;for(var i=this.attrsObj(),r=new Bline(t,e,i),n=0;n<this.children.length;n++)r.addEntry(this.children[n].children[0]);var s=this.parent.children.indexOf(this);this.parent.children[s]=r};var keyUpper=function(t){return t.replace(/\_./g,function(t){return t.charAt(1).toUpperCase()})};TagBuilder.prototype.layer=function(){var t=this.remAttr("type"),e=this.remAttr("active");e="false"!=e;var i=this.remAttr("exclude_from_rendering");i="false"!=i;for(var r=this.remAttr("version"),n=this.remAttr("desc"),s=this.attrsObj(),a=new Layer(t,e,i,r,n,s),o=0;o<this.children.length;o++){var h=this.children[o],l=h.attr("name"),c=keyUpper(l);a.addParam(c,l,h.children[0])}var u=this.parent.children.indexOf(this);this.parent.children[u]=a},TagBuilder.time=new Time,TagBuilder.prototype.canvas=function(){var t,e,i=this.attrsObj(),r=this.attr("width"),n=this.attr("height"),s=this.attr("view-box");if(s){s=s.split(" ");for(var a=0;4>a;a++)s[a]=parseFloat(s[a]);t={x:r/(s[2]-s[0]),y:n/(s[3]-s[1])},e={x:(s[2]-s[0])/2,y:(s[3]-s[1])/2}}var o=new Canvas(e,t,i);o.tag="canvas";for(var a=0;a<this.children.length;a++)"meta"==this.children[a].tag?o.metas.push(this.children[a]):"keyframe"==this.children[a].tag?o.keyframes.push(this.children[a]):"layer"==this.children[a].tag?o.layers.push(this.children[a]):o.addChild(this.children[a]);for(var a=0;a<o.layers.length;a++){for(var h=a,l=4294967296,c=a;c<o.layers.length;c++){var u=o.layers[c].zDepth;if(void 0===u){h=c;break}u=u.getValue(TagBuilder.time),l>u&&(h=c,l=u)}var d=o.layers[a];o.layers[a]=o.layers[h],o.layers[h]=d}var p=this.parent.children.indexOf(this);this.parent.children[p]=o},TagBuilder.prototype.name=function(){var t=this.attrsObj(),e=new GeneralElement(t);e.tag="name";for(var i=0;i<this.children.length;i++)e.addChild(this.children[i]);var r=this.parent.children.indexOf(this);this.parent.children[r]=e},TagBuilder.prototype.GlobalDocument=function(){for(var t=new DocumentElement,e=0;e<this.children.length;e++)t.addChild(this.children[e]);this.parent.document=t},TagBuilder.prototype.meta=function(){var t=this.remAttr("name"),e=this.remAttr("content"),i=this.attrsObj(),r=new Meta(t,e,i),n=this.parent.children.indexOf(this);this.parent.children[n]=r},TagBuilder.prototype.keyframe=function(){var t=Time.parse(this.remAttr("time")),e=this.remAttr("active");e="false"!=e;var i=this.children.length>0?this.children[0]:void 0,r=this.attrsObj(),n=new Keyframe(t,e,i,r),s=this.parent.children.indexOf(this);this.parent.children[s]=n},TagBuilder.prototype.time=function(){var t=Time.parse(this.remAttr("value")),e=this.attrsObj(),i=new GeneralElement(e);i.tag="time",i.selfClosing=this.selfClosing,i.keyAttrs.push("value"),i.value=t;var r=this.parent.children.indexOf(this);this.parent.children[r]=i},TagBuilder.prototype.animated=function(){for(var t=this.remAttr("type"),e=this.attrsObj(),i=new Animated(t,e),r=0;r<this.children.length;r++)i.addWaypoint(this.children[r]);var n=this.parent.children.indexOf(this);this.parent.children[n]=i},TagBuilder.prototype.color=function(){var t=parseFloat(this.getAllTypeWithAttrEq("r",0,0,1)[0].children[0].text),e=parseFloat(this.getAllTypeWithAttrEq("g",0,0,1)[0].children[0].text),i=parseFloat(this.getAllTypeWithAttrEq("b",0,0,1)[0].children[0].text),r=parseFloat(this.getAllTypeWithAttrEq("a",0,0,1)[0].children[0].text),n=this.attrsObj(),s=new Color(t,e,i,r,n),a=this.parent.children.indexOf(this);this.parent.children[a]=s},TagBuilder.prototype.remAttr=function(t){for(var e=0;e<this.attrs.length;e++)if(this.attrs[e][0]==t){var i=this.attrs[e].length>1?this.attrs[e][1]:null;return this.attrs.splice(e,1),i}},TagBuilder.prototype.attr=function(t,e){for(var i=-1,r=0;r<this.attrs.length;r++)this.attrs[r][0]==t&&(i=r);if(-1==i){if(!(arguments.length>1))return;1==e?this.attrs.push([t]):this.attrs.push([t,e])}else{var n=this.attrs[i];if(!(arguments.length>1))return n.length>1?n[1]:!0;e?n.length>1?n[1]=e:n.push(e):this.attrs.splice(i,1)}},TagBuilder.prototype.getAllTypeWithAttrEq=function(t,e,i,r){var n=[];if(!this.children)return n;for(var s=0;s<this.children.length;s++){var a=this.children[s];if(a.attrs&&a.tag==t)if(e){var o=a.attr(e);o==i&&n.push(a)}else n.push(a)}if(!r)for(var s=0;s<this.children.length;s++){var a=this.children[s];if(a.attrs){var h=a.getAllTypeWithAttrEq(type,e,i);n.push.apply(n,h)}}return n},SIFReader.prototype.closeTag=function(){this.context.finish(),this.context=this.context.parent},SIFReader.prototype.openTag=function(t){t.JKL||(this.context=t)},SIFReader.prototype.readLine=function(t){if(""!=t){this.resetLine(),this.setLine(t);var e,i,r=t.match(/\<([^\"\>\']*((\"((\\\\)*\\\")*(([^\\]((\\\\)*\\\")+)|[^\"])*\")|(\'((\\\\)*\\\')*(([^\\]((\\\\)*\\\')+)|[^\'])*\'))*)*\>/g),n=!1;if(!r)return void this.context.addChild(new TextElement(t));if(1!=r.length){var s=r[0],a=r[r.length-1];return this.readLine(s),this.readLine(t.substring(s.length,t.length-a.length)),void this.readLine(a)}if(e=r[0],i=t.split(e),-1!=i[0].search(/[^\s]/g)&&this.context.addChild(new TextElement(i[0])),"/"==e.charAt(1))return e==this.context.closeTag?void this.closeTag():void this.context.addChild(new TextElement(t));if("?"==e.charAt(1))return void this.context.addChild(new TextElement(t));"/"==e.charAt(e.length-2)&&(n=!0),t=e,e=t.match(/\<[^\s\>]+/g)[0].substring(1),t=t.substring(e.length+1,t.length-(n?2:1));var o=[],h=t.match(/[^\s]+\s*=\s*\"((\\\\)*\\\")*(([^\\]((\\\\)*\\\")+)|[^\"])*\"/g);h&&(o=h);for(var l=0;l<o.length;l++)t=t.replace(o[l],"");for(h=t.match(/[^\s]+\s*=\s*\'((\\\\)*\\\')*(([^\\]((\\\\)*\\\')+)|[^\'])*\'/g),h&&o.push.apply(o,h);l<o.length;l++)t=t.replace(o[l],"");for(h=t.match(/[^\s]+/g),h&&o.push.apply(o,h);l<o.length;l++)t=t.replace(o[l],"");var c=new TagBuilder(this.context,e,o,n);this.context.addChild(c),this.context=c,n&&this.closeTag(),i&&-1!=i[1].search(/[^\s]/g)&&this.context.addChild(new TextElement(i[1]))}},SIFReader.prototype.setLine=function(t){this.length=t.length,this.line=t},SIFReader.prototype.nextWord=function(t,e){var i=-1;if(this.index>=this.length)return null;for(var r=null,n=!0,s=this.index;n;){for(var a=0;a<t.length;a++){var o=t[a],h=this.line.indexOf(o,s);(i>h||-1==i)&&-1!=h&&(i=h,r=o)}n=!1,skipSym=null,symInd=-1;for(var a=0;a<e.length;a++){var o=e[a],h=this.line.indexOf(o,s);(i>h||h<symInd)&&-1!=h&&(skipSym=o,symInd=h)}skipSym&&(s=this.line.indexOf(skipSym,symInd+1)+1,n=!0,i=-1,r=null)}if(-1==i){var l=this.line.substring(this.index);return this.didFinish=!0,this.isValue="="==this.lastSym,this.isParam=" "==this.lastSym,this.index=this.length,l}var l=this.line.substring(this.index,i);return this.index=i+1,this.isValue="="==this.lastSym,this.isParam=" "==this.lastSym,this.lastSym=r,l},SIFReader.prototype.resetLine=function(){this.index=0,this.line="",this.length=0,this.didFinish=!1,this.isValue=!1,this.isParam=!0,this.lastSym=null};var ISHIGHDEF=window.matchMedia&&(window.matchMedia("only screen and (min-resolution: 124dpi), only screen and (min-resolution: 1.3dppx), only screen and (min-resolution: 48.8dpcm)").matches||window.matchMedia("only screen and (-webkit-min-device-pixel-ratio: 1.3), only screen and (-o-min-device-pixel-ratio: 2.6/2), only screen and (min--moz-device-pixel-ratio: 1.3), only screen and (min-device-pixel-ratio: 1.3)").matches)||window.devicePixelRatio&&window.devicePixelRatio>1.3;gsSCALE=1;try{gsSCALE=parseFloat(window.location.href.split("=")[1])||1}catch(e){}SIFRenderer.prototype.getLexicon=function(t){var e=this.lexicon[t];return e?e:e=this.lexicon[t]=new FontData(this.ctx,t)},FontData.prototype.heightOf=function(t){return this.unitheight*t},FontData.prototype.pxOf=function(t){return t/this.unitheight},SIFRenderer.prototype.save=function(){this.transformStack.push(this.currentTransform.copy())},SIFRenderer.prototype.restore=function(){this.currentTransform=this.transformStack.pop(),this.ctx.globalAlpha=this.currentTransform.a},transformVal.prototype.copy=function(t){var e=new transformVal(this.origin,this.oOrigin,this.oScale,this.angle,this.scale,this.a);if(this.clr){var i=this.clr;e.clr={r:i.r,g:i.g,b:i.b,a:i.a}}return e},transformVal.prototype.transformOrigin=function(t){this.origin.x+=Math.cos(this.theta)*t.x*this.scaleR.x-Math.sin(this.theta)*t.y*this.scaleR.y,this.origin.y+=Math.sin(this.theta)*t.x*this.scaleR.x+Math.cos(this.theta)*t.y*this.scaleR.y},transformVal.prototype.transformOOrigin=function(t){this.oOrigin={x:t.x*this.oScale.x,y:t.y*this.oScale.y}},transformVal.prototype.transformAlpha=function(t){this.a*=t},transformVal.prototype.transformScalePoint=function(t){return{x:t.x*this.scaleR.x-t.y*-this.scaleR.y,y:t.x*this.scaleR.x+t.y*-this.scaleR.y}},transformVal.prototype.transformPoint=function(t){return{x:this.oOrigin.x+this.origin.x+Math.cos(this.theta)*t.x*this.scaleR.x-Math.sin(this.theta)*t.y*this.scaleR.y,y:this.oOrigin.y+this.origin.y+Math.sin(this.theta)*t.x*this.scaleR.x+Math.cos(this.theta)*t.y*this.scaleR.y}},transformVal.prototype.transformOScale=function(t){this.oScale=t,this.scaleR={x:this.oScale.x*this.scale.x,y:this.oScale.y*this.scale.y}},transformVal.prototype.transformScale=function(t){this.scale.x*=t.x,this.scale.y*=t.y,this.scaleR={x:this.oScale.x*this.scale.x,y:this.oScale.y*this.scale.y}},transformVal.prototype.transformAngle=function(t){this.angle+=t,this.theta=this.angle*Math.PI/180},transformVal.prototype.transform=function(t,e,i,r){this.transformOrigin(t),this.transformAngle(e),this.transformScale(i),this.transformAlpha(r)},SIFRenderer.renderer=null,SIFRenderer.prototype.draw=function(){this.ctx.clearRect(0,0,1e3,1e3),this.drawingOrigins=!1,this.general(this.document),this.shouldDrawOr&&(this.drawingOrigins=!0,this.general(this.document))},SIFRenderer.prototype.drawSomething=function(t){this.drawingOrigins=!1,this.general(t.document),this.shouldDrawOr&&(this.drawingOrigins=!0,this.general(t.document))},SIFRenderer.prototype.general=function(t){if(t)for(var e=t.children,i=0;i<e.length;i++)this[e[i].tag]&&this[e[i].tag](e[i])},SIFRenderer.prototype.canvas=function(t){if(t)for(var e=t.layers,i=0;i<e.length;i++)this[e[i].tag]&&this[e[i].tag](e[i])},SIFRenderer.prototype.color=function(t,e){if(t){var t=t.getValue(this.time)+"";e?(this.ctx.strokeStyle=t,this.ctx.fillStyle=t):(this.ctx.strokeStyle=t,this.ctx.fillStyle=t)}},SIFRenderer.prototype.drawPt=function(t){var e=this.ctx;this.drawingOrigins&&(e.save(),e.beginPath(),e.arc(t.x,t.y,5,0,2*Math.PI,!1),e.fillStyle="green",e.fill(),e.strokeStyle="#003300",e.stroke(),e.restore())},SIFRenderer.prototype.getT=function(t,e,i){t={theta:t.theta.getValue(this.time),radius:t.radius.getValue(this.time)},this.save(),this.currentTransform.oOrigin={x:0,y:0},2==e?t.theta=t.theta:(t.theta=t.theta,t.radius=-t.radius);var r=new transformVal({x:0,y:0},{x:0,y:0},{x:1,y:1},t.theta,{x:1,y:1});this.currentTransform.origin=i;var n={x:t.radius/3,y:0};return n=r.transformPoint(n),n=this.currentTransform.transformPoint(n),this.restore(),n},SIFRenderer.prototype.transform=function(t,e){return t?(this.currentTransform.transform(t.offset.getValue(this.time),-t.angle.getValue(this.time),t.scale.getValue(this.time),e.getValue(this.time)),void(this.ctx.globalAlpha=this.currentTransform.a)):void(e&&(this.currentTransform.transformAlpha(e.getValue(this.time)),this.ctx.globalAlpha=this.currentTransform.a))},SIFRenderer.prototype.origin=function(t,e){if(t){var t=t.getValue(this.time);this.currentTransform.transformOrigin({x:-t.x,y:-t.y});var i=this.currentTransform.transformPoint(t);e&&this.drawPt(i)}},SIFRenderer.prototype.bline=function(t,e){if(t){var i=this.ctx;if(!this.drawingOrigins){for(var r=[],n=t.loop,s=[],a=t.entries,o=0;o<a.length;o++){var h=a[o],l=h.point.getValue(this.time),c=this.currentTransform.transformPoint(l);r.push(c),s.push({t1:this.getT(h.t1,1,c),t2:this.getT(h.t2,2,c)})}i.beginPath(),i.moveTo(r[0].x,r[0].y);for(var o=1;o<r.length;o++){var u=s[o-1].t2,d=s[o].t1;i.bezierCurveTo(u.x,u.y,d.x,d.y,r[o].x,r[o].y)}var u=s[s.length-1].t2,d=s[0].t1;if(n&&i.bezierCurveTo(u.x,u.y,d.x,d.y,r[0].x,r[0].y),e){if(this.currentTransform.clr){var p=this.currentTransform.clr;i.fillStyle="rgba("+p.r+","+p.g+","+p.b+","+p.a+")"}i.fill()}else i.stroke()}}},SIFRenderer.prototype.layer=function(t,e){if(t){var i="group"==t.type;if(this.save(),e){var r=this.currentTransform.clr,n=t.trans.copy();r&&(n.clr=r),this.currentTransform=n}else t.trans=this.currentTransform.copy();this.transform(t.transformation,t.amount);var s=(this.origin(t.origin,i),t.type);if("region"==s||"outline"==s){var a="region"==s;this.color(t.color),this.bline(t.bline,a)}else if("text"==s){this.ctx.save(),this.color(t.color);var o=t.family.getValue(this.time),h=this.getLexicon(o),l=this.currentTransform.transformScalePoint(t.size.getValue(this.time));l.y*=.9,this.ctx.font=h.pxOf(l.y)+"px "+o;var c=t.orient.getValue(this.time),u=t.origin.getValue(this.time),d=this.currentTransform.angle;this.currentTransform.angle=0,this.currentTransform.transformOrigin(u);var p=this.currentTransform.transformPoint(u);this.ctx.translate(p.x,p.y),d%360!=0&&this.ctx.rotate(d/180*Math.PI);for(var f=1,m=t.text.getValue(this.time).split("\n"),g=m.length,y=0,v=0;g>v;v++){var x=this.ctx.measureText(m[v]).width;x>y&&(y=x),f&&this.ctx.fillText(m[v],u.x-x*c.x,u.y-l.y*(g-1)*c.y+v*l.y*1.2+(2*g-1)*l.y/15)}if(!f)for(var v=0;g>v;v++)this.ctx.fillText(m[v],u.x-y*c.x,u.y-l.y*(g-1)*c.y+v*l.y*1.2+(2*g-1)*l.y/15);this.ctx.restore()}t.fTrans=this.currentTransform.copy(),this.canvas(t.canvas),SIFRenderer.renderer.restore()}};var last=0,hideeverything=!1,pEditor=null;PartEditor.prototype.keydown=function(t){if("INPUT"!=t.target.nodeName){var e=t.which||t.keyCode;switch(e){case 37:this.shouldMove?(this.origin.x-=1/this.editing.fTrans.scale.x*this.speed,this.offset.x-=1/this.editing.trans.scale.x*this.speed):this.shouldRotate&&(this.transf.angle-=1*this.speed);break;case 39:this.shouldMove?(this.origin.x+=1/this.editing.fTrans.scale.x*this.speed,this.offset.x+=1/this.editing.trans.scale.x*this.speed):this.shouldRotate&&(this.transf.angle+=1*this.speed);break;case 38:this.shouldMove&&(this.origin.y-=1/this.editing.fTrans.scale.y*this.speed,this.offset.y-=1/this.editing.trans.scale.y*this.speed);break;case 40:this.shouldMove&&(this.origin.y+=1/this.editing.fTrans.scale.y*this.speed,this.offset.y+=1/this.editing.trans.scale.y*this.speed);break;case 77:this.shouldMove=!0,this.shouldRotate=!1;break;case 219:this.speed/=2;break;case 221:this.speed*=2;break;case 82:this.shouldMove=!1,this.shouldRotate=!0;break;default:return void console.log(e)}setFormProps(),SIFRenderer.renderer.draw(),dL(this.editing),t.preventDefault(),t.stopPropagation()}},pEditor=new PartEditor,window.onload=function(){loadSif("logo"),loadSif("blackfade"),loadSif("theatlas"),loadSif("nmssky"),loadSif("blank"),RenderLoop(),SpiceGame.Init()};var SceneContext={},SpiceGame={};SpiceGame.Init=function(){SpiceGame.RunLogo()},SpiceGame.RunLogo=function(){return drawables.push(new SIFObject(mySifs.logo,-1,-1,SpiceGame.doneRunLogo)),!1},SpiceGame.doneRunLogo=function(){drawables=[],hideeverything=!0;var t=new SIFObject(mySifs.nmssky,-1,-1);return t.currenttime.seconds-=1.3,drawables.push(t),drawables.push(new SIFObject(mySifs.theatlas,-1,-1)),drawables.push(new SIFObject(mySifs.blackfade,0,1,SpiceGame.RemoveCaller)),!1},SpiceGame.RemoveCaller=function(t){return drawables.splice(drawables.indexOf(t),1),!1};var mySifs={},drawables=[];Time.prototype.add=function(t){this.frames+=t.frames,this.seconds+=t.seconds},Time.prototype.absolute=function(){return this.frames/this.fps+this.seconds},Time.prototype.toString=function(){var t="",e=!1;return this.seconds>0&&(e&&(t+=" "),t+=this.seconds+"s",e=!0),this.frames>0&&(e&&(t+=" "),t+=this.frames+"f",e=!0),e||(t+="0f"),t},Time.parse=function(t){for(var e=t.split(" "),i=0,r=0,n=0;n<e.length;n++){var s=e[n].substring(e[n].length-1),a=parseFloat(e[n]);if("f"==s)i+=a;else if("s"==s)r+=a;else if("m"==s)r+=60*a;else{if("h"!=s)throw new Error("Time ABRT");r+=3600*a}}return new Time(r,i)},Time.fps=24,SIFElement.prototype.openXML=function(t,e,i){
var r=t+"<"+this.tag;return r+=this.toXMLAttrs(t,e,i),r+=">\n"},SIFElement.prototype.closeXML=function(t,e){return t+"</"+this.tag+">\n"},SIFElement.prototype.toXMLSelfClosing=function(t,e){return t+"<"+this.tag+this.toXMLAttrs(t,e)+"/>"},SIFElement.prototype.toXMLAttrs=function(t,e,i){var r="";for(var n in this.attrs)r+=" "+n+'="'+this.attrs[n]+'"';if(i)for(var s=0;s<i.length;s++){var a=this.toUnderscorePair(i[s]);r+=" "+a[1]+'="'+this[a[0]]+'"'}return r},SIFElement.prototype.toUnderscorePair=function(t){var e,i=t.constructor==jL.aryCons?t[0]:t;return t.constructor==jL.strCons?(e=t,e.toLowerCase()!=e&&(e=e.replace(/[A-Z]/g,function(t){return"_"+t.toLowerCase()}))):e=t[1],[i,e]},SIFElement.prototype.addChild=function(t){this.children.push(t)},TextElement.prototype.toXML=function(t,e){return t+this.text},jL.subClass(SIFElement,GeneralElement),GeneralElement.prototype.toXML=function(t,e){var i="";if(this.selfClosing)i+="<"+this.tag+this.toXMLAttrs(t,e,this.keyAttrs)+"/>";else{i+=this.openXML(t,e,this.keyAttrs);for(var r=0;r<this.children.length;r++)i+=this.children[r].toXML(t+e,e);i+=this.closeXML(t,e)}return i},jL.subClass(GeneralElement,Canvas),Canvas.prototype.toXML=function(t,e){var i="";if(this.selfClosing)i+="<"+this.tag+this.toXMLAttrs(t,e,this.keyAttrs)+"/>";else{i+=this.openXML(t,e,this.keyAttrs);for(var r=0;r<this.children.length;r++)i+=this.children[r].toXML(t+e,e);for(var r=0;r<this.metas.length;r++)i+=this.metas[r].toXML(t+e,e);for(var r=0;r<this.keyframes.length;r++)i+=this.keyframes[r].toXML(t+e,e);for(var r=0;r<this.layers.length;r++)i+=this.layers[r].toXML(t+e,e);i+=this.closeXML(t,e)}return i},jL.subClass(SIFElement,DocumentElement),DocumentElement.prototype.toXML=function(t,e){for(var i="",r=0;r<this.children.length;r++)i+=this.children[r].toXML(t,e);return i},jL.subClass(SIFElement,VectorSuper),VectorSuper.prototype.toXML=function(t,e){for(var i=this.openXML(t,e),r=0;r<this.keys.length;r++){var n=this.keys[r];i+=t+e+"<"+n+">"+this[n]+"</"+n+">\n"}return i+=this.closeXML(t,e)},VectorSuper.prototype.getValue=function(t){return this},jL.subClass(VectorSuper,Vector),Vector.prototype.tangent=function(t,e,i,r,n,s){var a=n-r,o=s-n,h=((e.x-t.x)/a+(i.x-e.x)/o)/2,l=((e.y-t.y)/a+(i.y-e.y)/o)/2;return{x:h,y:l}},Vector.prototype.bezier=function(t,e,i,r,n,s){var a=s-n,o=a/4,h=new Bezier(t.x,t.x+i.x*o,e.x-r.x*o,e.x,n,n+o,s-o),l=new Bezier(t.x,t.x+i.x*o,e.x-r.x*o,e.x,n,n+o,s-o);return{x:h,y:l}},Vector.prototype.linear=function(t,e,i,r,n,s){var a=s-n,o=a/4,h=new Bezier(t.x,t.x+i.x*o,e.x-r.x*o,e.x,n,n+o,s-o),l=new Bezier(t.x,t.x+i.x*o,e.x-r.x*o,e.x,n,n+o,s-o);return{x:h,y:l}},Vector.prototype.between=function(t,e){return new Vector((t.x-this.x)*e+this.x,(t.y-this.y)*e+this.y,this.attrs)},jL.subClass(VectorSuper,Color),Color.prototype.tangent=function(t,e,i,r,n,s){var a=n-r,o=s-n,h=((e.r-t.r)/a+(i.r-e.r)/o)/2,l=((e.g-t.g)/a+(i.g-e.g)/o)/2,c=((e.b-t.b)/a+(i.b-e.b)/o)/2,u=((e.a-t.a)/a+(i.a-e.a)/o)/2;return{r:h,g:l,b:c,a:u}},Color.prototype.bezier=function(t,e,i,r,n,s){var a=s-n,o=a/4,h=new Bezier(t.r,t.r+i.r*o,e.r-r.r*o,e.r,n,n+o,s-o),l=new Bezier(t.g,t.g+i.g*o,e.g-r.g*o,e.g,n,n+o,s-o),c=new Bezier(t.b,t.b+i.b*o,e.b-r.b*o,e.b,n,n+o,s-o),u=new Bezier(t.a,t.a+i.a*o,e.a-r.a*o,e.a,n,n+o,s-o);return{r:h,g:l,b:c,a:u}},Color.prototype.between=function(t,e){return new Color((t.r-this.r)*e+this.r,(t.g-this.g)*e+this.g,(t.b-this.b)*e+this.b,(t.a-this.a)*e+this.a,this.attrs)},Color.prototype.toString=function(){return"rgba("+(256*this.r>>0)+","+(256*this.g>>0)+","+(256*this.b>>0)+","+this.a+")"},jL.subClass(SIFElement,Keyframe),Keyframe.prototype.toXML=function(t,e){var i=t+"<"+this.tag+' time="'+this.time+'" active="'+this.active+'"'+this.toXMLAttrs(t,e);return this.desc?i+">"+this.desc.toXML(t,e)+"</keyframe>\n":i+"/>\n"},jL.subClass(SIFElement,Name),Name.prototype.toXML=function(t,e){return t+"<"+this.tag+this.toXMLAttrs(t,e)+">"+this.content+"</"+this.tag+">\n"},jL.subClass(SIFElement,Layer),Layer.prototype.addParam=function(t,e,i){this.paramKeys.push([t,e]),this[t]=i},Layer.prototype.toXML=function(t,e){for(var i=t+"<"+this.tag+this.toXMLAttrs(t,e,this.keyAttrs)+">\n",r=t+e,n=0;n<this.paramKeys.length;n++){var s=this.toUnderscorePair(this.paramKeys[n]);i+=r+'<param name="'+s[1]+'">\n',i+=this[s[0]].toXML(r+e,e),i+=r+"</param>\n"}return i+=this.closeXML(t,e)},jL.subClass(SIFElement,Meta),Meta.prototype.toXML=function(t,e){return t+"<"+this.tag+' name="'+this.name+'" content="'+this.content+'"'+this.toXMLAttrs(t,e)+"/>\n"},jL.subClass(SIFElement,Real),Real.prototype.toXML=function(t,e){return t+"<"+this.tag+' value="'+this.value+'"'+this.toXMLAttrs(t,e)+"/>\n"},Real.prototype.getValue=function(t){return this.value},Real.prototype.tangent=function(t,e,i,r,n,s){var a=((e.value-t.value)/(n-r)+(i.value-e.value)/(s-n))/2;return{value:a}},Real.prototype.bezier=function(t,e,i,r,n,s){var a=s-n,o=a/4,h=new Bezier(t.value,t.value+i.value*o,e.value-r.value*o,e.value,n,n+o,s-o);return{value:h}},Real.prototype.between=function(t,e){return new this.constructor((t.value-this.value)*e+this.value,this.attrs)},jL.subClass(Real,SIFString),SIFString.prototype.between=function(t,e){return new this.constructor(this.value,this.attrs)},jL.subClass(Real,Bool),Bool.prototype.tangent=function(){return null},Bool.prototype.bezier=function(t,e){return new ConstantBezier(t,e)},jL.subClass(Real,Integer),Integer.prototype.tangent=function(){return null},Integer.prototype.bezier=function(t,e){return new ConstantBezier(t,e)},jL.subClass(Real,Angle),jL.subClass(SIFElement,TagHolder),TagHolder.prototype.toXML=function(t,e){var i=this.openXML(t,e);return i+=this.held.toXML(t+e,e),i+=this.closeXML(t,e)},TagHolder.prototype.getValue=function(t){return this.held.getValue(t)},jL.subClass(SIFElement,Waypoint),Waypoint.prototype.getValue=function(t){return this.held.getValue(t)},Waypoint.prototype.toXML=function(t,e){var i=t+"<"+this.tag+' time="'+this.time+'" before="'+this.before+'" after="'+this.after+'"'+this.toXMLAttrs(t,e)+">\n";return i+=this.held.toXML(t+e,e),i+=this.closeXML(t,e)},jL.subClass(SIFElement,Animated),Animated.prototype.toXML=function(t,e){for(var i=t+"<"+this.tag+' type="'+this.type+'"'+this.toXMLAttrs(t,e)+">\n",r=0;r<this.waypoints.length;r++)i+=this.waypoints[r].toXML(t+e,e);return i+=this.closeXML(t,e)},Animated.prototype.addWaypoint=function(t){this.waypoints.push(t),this.times.push(t.time.absolute())},Animated.prototype.getValue=function(t){var e=t.absolute(),i=0,r=this.times.length-1;if(e>this.times[r])i=r;else{r=binaryIndexOf(this.times,e),i=r==this.times.length-1?Math.max(r-1,0):0==r?r+1:e-this.times[r]>0?r+1:r-1;var n=r>i;if(!n){var t=r;r=i,i=t}}var s=this.times[r]-this.times[i],a=this.waypoints[i],o=this.waypoints[r],h=(e-this.times[i])/s;h=Math.min(1,h),h=Math.max(0,h),Math.abs(s)<.01&&(h=1);var l=TweenMath[a.after];return h=l>h?Tween[a.after](h):Tween[o.before](h-l)+l,a=a.getValue(t),o=o.getValue(t),a.between?a.between(o,h):(o-a)*h+a},Animated.prototype.createTangents=function(){for(var t=1;t<this.waypoints.length-1;t++)this.waypoints.held.tangent()},jL.subClass(SIFElement,Bline),Bline.prototype.toXML=function(t,e){for(var i=t+"<"+this.tag+' type="'+this.type+'" loop="'+this.loop+'"'+this.toXMLAttrs(t,e)+">\n",r=t+e,n=0;n<this.entries.length;n++)i+=r+"<entry>\n",i+=this.entries[n].toXML(r+e,e),i+=r+"</entry>\n";return i+=this.closeXML(t,e)},Bline.prototype.addEntry=function(t){this.entries.push(t)},jL.subClass(SIFElement,Composite),Composite.prototype.toXML=function(t,e){for(var i=t+"<"+this.tag+' type="'+this.type+'"'+this.toXMLAttrs(t,e)+">\n",r=t+e,n=0;n<this.keypairs.length;n++)i+=r+"<"+this.keypairs[n][1]+">\n",i+=this[this.keypairs[n][0]].toXML(r+e,e),i+=r+"</"+this.keypairs[n][1]+">\n";return i+=this.closeXML(t,e)},jL.subClass(Composite,RadialComposite),SIFObject.prototype.addTime=function(t){return this.currenttime.add(t),this.currenttime.absolute()>this.endtime.absolute()&&(this.loops?(this.currenttime.frames=this.starttime.frames,this.currenttime.seconds=this.starttime.seconds):(this.currenttime.frames=this.endtime.frames,this.currenttime.seconds=this.endtime.seconds),this.call)?this.call(this):!0};var TweenMath={outlinear:.5,outconstant:1,outclamped:.5,outhalt:.5},Tween={swing:function(t,e,i,r){return-i*(t/=r)*(t-2)+e},inlinear:function(t){return t},outlinear:function(t){return t},inconstant:function(t){return 1},outconstant:function(t){return 0},outclamped:function(t){return.5*(t/=.5)*t},inclamped:function(t){return-.5*(t/=.5)*(t-2)},outhalt:function(t){return.5*(t/=.5)*t},inhalt:function(t){return-.5*(t/=.5)*(t-2)},easeInQuad:function(t,e,i,r){return i*(t/=r)*t+e},easeOutQuad:function(t,e,i,r){return-i*(t/=r)*(t-2)+e},easeInOutQuad:function(t,e,i,r){return(t/=r/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},easeInCubic:function(t,e,i,r){return i*(t/=r)*t*t+e},easeOutCubic:function(t,e,i,r){return i*((t=t/r-1)*t*t+1)+e},easeInOutCubic:function(t,e,i,r){return(t/=r/2)<1?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e},easeInQuart:function(t,e,i,r){return i*(t/=r)*t*t*t+e},easeOutQuart:function(t,e,i,r){return-i*((t=t/r-1)*t*t*t-1)+e},easeInOutQuart:function(t,e,i,r){return(t/=r/2)<1?i/2*t*t*t*t+e:-i/2*((t-=2)*t*t*t-2)+e},easeInQuint:function(t,e,i,r){return i*(t/=r)*t*t*t*t+e},easeOutQuint:function(t,e,i,r){return i*((t=t/r-1)*t*t*t*t+1)+e},easeInOutQuint:function(t,e,i,r){return(t/=r/2)<1?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e},easeInSine:function(t,e,i,r){return-i*Math.cos(t/r*(Math.PI/2))+i+e},easeOutSine:function(t,e,i,r){return i*Math.sin(t/r*(Math.PI/2))+e},easeInOutSine:function(t,e,i,r){return-i/2*(Math.cos(Math.PI*t/r)-1)+e},easeInExpo:function(t,e,i,r){return 0==t?e:i*Math.pow(2,10*(t/r-1))+e},easeOutExpo:function(t,e,i,r){return t==r?e+i:i*(-Math.pow(2,-10*t/r)+1)+e},easeInOutExpo:function(t,e,i,r){return 0==t?e:t==r?e+i:(t/=r/2)<1?i/2*Math.pow(2,10*(t-1))+e:i/2*(-Math.pow(2,-10*--t)+2)+e},easeInCirc:function(t,e,i,r){return-i*(Math.sqrt(1-(t/=r)*t)-1)+e},easeOutCirc:function(t,e,i,r){return i*Math.sqrt(1-(t=t/r-1)*t)+e},easeInOutCirc:function(t,e,i,r){return(t/=r/2)<1?-i/2*(Math.sqrt(1-t*t)-1)+e:i/2*(Math.sqrt(1-(t-=2)*t)+1)+e},easeInElastic:function(t,e,i,r){var n=1.70158,s=0,a=i;if(0==t)return e;if(1==(t/=r))return e+i;if(s||(s=.3*r),a<Math.abs(i)){a=i;var n=s/4}else var n=s/(2*Math.PI)*Math.asin(i/a);return-(a*Math.pow(2,10*(t-=1))*Math.sin((t*r-n)*(2*Math.PI)/s))+e},easeOutElastic:function(t,e,i,r){var n=1.70158,s=0,a=i;if(0==t)return e;if(1==(t/=r))return e+i;if(s||(s=.3*r),a<Math.abs(i)){a=i;var n=s/4}else var n=s/(2*Math.PI)*Math.asin(i/a);return a*Math.pow(2,-10*t)*Math.sin((t*r-n)*(2*Math.PI)/s)+i+e},easeInOutElastic:function(t,e,i,r){var n=1.70158,s=0,a=i;if(0==t)return e;if(2==(t/=r/2))return e+i;if(s||(s=r*(.3*1.5)),a<Math.abs(i)){a=i;var n=s/4}else var n=s/(2*Math.PI)*Math.asin(i/a);return 1>t?-.5*(a*Math.pow(2,10*(t-=1))*Math.sin((t*r-n)*(2*Math.PI)/s))+e:a*Math.pow(2,-10*(t-=1))*Math.sin((t*r-n)*(2*Math.PI)/s)*.5+i+e},easeInBack:function(t,e,i,r,n){return void 0==n&&(n=1.70158),i*(t/=r)*t*((n+1)*t-n)+e},easeOutBack:function(t,e,i,r,n){return void 0==n&&(n=1.70158),i*((t=t/r-1)*t*((n+1)*t+n)+1)+e},easeInOutBack:function(t,e,i,r,n){return void 0==n&&(n=1.70158),(t/=r/2)<1?i/2*(t*t*(((n*=1.525)+1)*t-n))+e:i/2*((t-=2)*t*(((n*=1.525)+1)*t+n)+2)+e},easeInBounce:function(t,e,i,r){return i-Tween.eobJ(r-t,0,i,r)+e},eobJ:function(t,e,i,r){return(t/=r)<1/2.75?i*(7.5625*t*t)+e:2/2.75>t?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:2.5/2.75>t?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e},easeOutBounce:function(t,e,i,r){return(t/=r)<1/2.75?i*(7.5625*t*t)+e:2/2.75>t?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:2.5/2.75>t?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e},easeInOutBounce:function(t,e,i,r){return r/2>t?.5*Tween.easeInBounce(2*t,0,i,r)+e:.5*Tween.easeOutBounce(2*t-r,0,i,r)+.5*i+e}};